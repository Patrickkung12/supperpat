<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üçΩÔ∏è ‡πÅ‡∏≠‡∏õ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≤‡∏£‡πå‡πÇ‡∏ö‡πÑ‡∏Æ‡πÄ‡∏î‡∏£‡∏ï</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* ‚úÖ ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            background-color: #fff;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h2, h3, h4 {
            text-align: center;
            color: #4CAF50;
        }

        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }

        input, select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        input:focus, select:focus {
            border-color: #4CAF50;
            outline: none;
        }

        /* ‚úÖ ‡∏õ‡∏∏‡πà‡∏° */
        button {
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #388E3C;
        }

        /* ‚úÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ */
        ul {
            list-style: none;
            padding: 0;
        }

        li {
            background-color: #f9f9f9;
            margin: 5px 0;
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        li button {
            background-color: #f44336;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            color: white;
        }

        li button:hover {
            background-color: #d32f2f;
        }

        /* ‚úÖ ‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥ */
        canvas {
            margin: 20px auto;
            display: block;
        }

        /* ‚úÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô */
        .flatpickr-calendar {
            border-radius: 10px;
        }

        /* ‚úÖ Media Queries */
        @media (max-width: 600px) {
            input, select, button {
                width: 100%;
            }
        }

        .highlight { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .info { color: #2196F3; font-weight: bold; }
    </style>
</head>

<body>

<div class="container">
    <h2>üçΩÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≤‡∏£‡πå‡πÇ‡∏ö‡πÑ‡∏Æ‡πÄ‡∏î‡∏£‡∏ï‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</h2>

    <!-- ‚úÖ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
    <form id="calorie-form">
        <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.): <input type="number" id="weight" required></label>
        <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.): <input type="number" id="height" required></label>
        <label>‡πÄ‡∏û‡∏®:
            <select id="gender">
                <option value="male">‡∏ä‡∏≤‡∏¢</option>
                <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
            </select>
        </label>
        <label>‡∏≠‡∏≤‡∏¢‡∏∏: <input type="number" id="age" required></label>
        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢:
            <select id="activity">
                <option value="1.2">‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</option>
                <option value="1.375">‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (1-3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                <option value="1.55">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (3-5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                <option value="1.725">‡πÄ‡∏¢‡∏≠‡∏∞ (6-7 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                <option value="1.9">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</option>
            </select>
        </label>
        <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏Å‡∏Å.): <input type="number" id="target-weight" required></label>
        <button type="button" onclick="calculateCalories()">üöÄ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
    </form>

    <div id="result"></div>

    <hr>

    <h3>üçõ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
    <input type="text" id="food-search" placeholder="üîç ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£..." oninput="searchFood()">
    <ul id="food-list"></ul>

    <h4>‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</h4>
    <ul id="selected-foods"></ul>

    <canvas id="calorieChart" width="400" height="400"></canvas>
    <canvas id="carbChart" width="400" height="400"></canvas>

    <hr>

    <h3>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå/‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
    <input type="text" id="calendar" placeholder="üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà">
    <button onclick="viewWeeklyReport()">üìÖ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
    <button onclick="viewMonthlyReport()">üìÜ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>

    <canvas id="weeklyChart" width="400" height="200"></canvas>
    <canvas id="monthlyChart" width="400" height="200" style="display:none;"></canvas>

    <h3>‚öñÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</h3>
    <input type="number" id="current-weight" placeholder="üí™ ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å‡∏Å.)">
    <button onclick="saveWeight()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</button>
    <canvas id="weightChart" width="400" height="200"></canvas>
</div>

<script>
    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    const foodDatabase = [
        { name: "‡∏Ç‡πâ‡∏≤‡∏ß (1 ‡∏ó‡∏±‡∏û‡∏û‡∏µ)", calories: 80, carbs: 15 },
        { name: "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î (1 ‡∏ó‡∏±‡∏û‡∏û‡∏µ)", calories: 90, carbs: 15 },
        { name: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á (1 ‡πÅ‡∏ú‡πà‡∏ô)", calories: 80, carbs: 15 },
        { name: "‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ó‡∏£‡∏≤‡∏¢ (3 ‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤)", calories: 60, carbs: 15 },
        { name: "‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î (1 ‡∏à‡∏≤‡∏ô‡πÄ‡∏•‡πá‡∏Å)", calories: 60, carbs: 15 },
        { name: "‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ (1 ‡πÅ‡∏Å‡πâ‡∏ß - 120 ‡∏°‡∏•.)", calories: 60, carbs: 15 },
        { name: "‡∏ô‡∏°‡∏™‡∏î (1 ‡∏Å‡∏•‡πà‡∏≠‡∏á - 240 ‡∏°‡∏•.)", calories: 120, carbs: 12 },
        { name: "‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï (1 ‡∏ñ‡πâ‡∏ß‡∏¢ - 200 ‡∏°‡∏•.)", calories: 135, carbs: 17 },
        { name: "‡∏ú‡∏±‡∏Å‡∏™‡∏î (6 ‡∏ó‡∏±‡∏û‡∏û‡∏µ)", calories: 30, carbs: 5 },
        { name: "‡∏ú‡∏±‡∏Å‡∏™‡∏∏‡∏Å (3 ‡∏ó‡∏±‡∏û‡∏û‡∏µ)", calories: 30, carbs: 5 }
    ];

    let calorieGoal = 0, carbGoal = 0, totalCalories = 0, totalCarbs = 0, selectedFoods = [];
    let calorieChart, carbChart, foodData = JSON.parse(localStorage.getItem('foodData')) || {};
    let currentDate = new Date().toISOString().split('T')[0];

    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≤‡∏£‡πå‡πÇ‡∏ö‡πÑ‡∏Æ‡πÄ‡∏î‡∏£‡∏ï
    function calculateCalories() {
        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);
        const age = parseInt(document.getElementById('age').value);
        const gender = document.getElementById('gender').value;
        const activity = parseFloat(document.getElementById('activity').value);

        let BMR = (gender === "male")
            ? 10 * weight + 6.25 * height - 5 * age + 5
            : 10 * weight + 6.25 * height - 5 * age - 161;

        calorieGoal = BMR * activity;
        carbGoal = (calorieGoal * 0.5) / 4;

        document.getElementById('result').innerHTML = `
            <p>üéØ ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: <span class="success">${calorieGoal.toFixed(0)} kcal</span></p>
            <p>üéØ ‡∏Ñ‡∏≤‡∏£‡πå‡πÇ‡∏ö‡πÑ‡∏Æ‡πÄ‡∏î‡∏£‡∏ï‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: <span class="success">${carbGoal.toFixed(0)} g</span></p>
        `;

        updateCharts();
    }

    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    function searchFood() {
        const searchTerm = document.getElementById('food-search').value.toLowerCase();
        const filteredFoods = foodDatabase.filter(food => food.name.toLowerCase().includes(searchTerm));
        const foodList = document.getElementById('food-list');
        foodList.innerHTML = "";

        filteredFoods.forEach(food => {
            const li = document.createElement('li');
            li.innerHTML = `${food.name} - ${food.calories} kcal, ${food.carbs} g ‡∏Ñ‡∏≤‡∏£‡πå‡∏ö 
                <button onclick="addFood('${food.name}')">‚ûï</button>`;
            foodList.appendChild(li);
        });
    }

    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π
    function addFood(foodName) {
        const food = foodDatabase.find(f => f.name === foodName);
        selectedFoods.push(food);
        totalCalories += food.calories;
        totalCarbs += food.carbs;

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage ‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
        if (!foodData[currentDate]) foodData[currentDate] = [];
        foodData[currentDate].push(food);
        localStorage.setItem('foodData', JSON.stringify(foodData));

        updateSelectedFoods();
        updateCharts();
        checkOverConsumption();
    }

    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    function updateSelectedFoods() {
        const list = document.getElementById('selected-foods');
        list.innerHTML = "";
        selectedFoods.forEach(food => {
            const li = document.createElement('li');
            li.innerText = ${food.name} - ${food.calories} kcal, ${food.carbs} g ‡∏Ñ‡∏≤‡∏£‡πå‡∏ö;
            list.appendChild(li);
        });
    }

    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü
    function updateCharts() {
        const calorieCtx = document.getElementById('calorieChart').getContext('2d');
        const carbCtx = document.getElementById('carbChart').getContext('2d');

        if (calorieChart) calorieChart.destroy();
        if (carbChart) carbChart.destroy();

        calorieChart = new Chart(calorieCtx, {
            type: 'doughnut',
            data: {
                labels: ['‡∏ó‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', '‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢'],
                datasets: [{
                    data: [totalCalories, Math.max(calorieGoal - totalCalories, 0), Math.max(totalCalories - calorieGoal, 0)],
                    backgroundColor: ['#FFEB3B', '#BDBDBD', '#F44336']
                }]
            },
            options: { plugins: { legend: { position: 'bottom' } } }
        });

        carbChart = new Chart(carbCtx, {
            type: 'doughnut',
            data: {
                labels: ['‡∏ó‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', '‡πÄ‡∏´‡∏•‡∏∑‡∏≠', '‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢'],
                datasets: [{
                    data: [totalCarbs, Math.max(carbGoal - totalCarbs, 0), Math.max(totalCarbs - carbGoal, 0)],
                    backgroundColor: ['#03A9F4', '#BDBDBD', '#F44336']
                }]
            },
            options: { plugins: { legend: { position: 'bottom' } } }
        });
    }

    // ‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤
    function checkOverConsumption() {
        if (totalCalories > calorieGoal) alert("‚ö†Ô∏è ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢!");
        if (totalCarbs > carbGoal) alert("‚ö†Ô∏è ‡∏Ñ‡∏≤‡∏£‡πå‡πÇ‡∏ö‡πÑ‡∏Æ‡πÄ‡∏î‡∏£‡∏ï‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢!");
    }

    // ‚úÖ ‡πÉ‡∏ä‡πâ Flatpickr ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    flatpickr("#calendar", {
        dateFormat: "Y-m-d",
        onChange: function(selectedDates, dateStr) {
            currentDate = dateStr;
            loadFoodDataForDate(dateStr);
        }
    });

    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    function loadFoodDataForDate(date) {
        selectedFoods = foodData[date] || [];
        totalCalories = selectedFoods.reduce((sum, food) => sum + food.calories, 0);
        totalCarbs = selectedFoods.reduce((sum, food) => sum + food.carbs, 0);
        updateSelectedFoods();
        updateCharts();
    }

    // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    window.onload = () => {
        loadFoodDataForDate(currentDate);
    };
</script>
</body>
</html>